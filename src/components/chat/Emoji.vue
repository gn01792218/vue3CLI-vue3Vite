<template>
  <div class="emojiList p-3">
    <ul class="d-flex flex-wrap justify-content-start">
      <li
        class="emoji"
        @click="addEmoji(emoji)"
        v-for="emoji in emojiList"
        :key="emoji"
      >
        {{ emoji }}
      </li>
    </ul>
  </div>
</template>

<script lang="ts">
import { computed, defineComponent, onMounted } from "vue";
import { useRoute } from "vue-router";
import { useStore } from "vuex";
export default defineComponent({
  setup(props, { emit }) {
    onMounted(() => {
      emojiListUnfocusListener();
    });
    const emojiList = [
      "👍🏻",
      "👎🏻",
      "😀",
      "😀",
      "😄",
      "😁",
      "😆",
      "😅",
      "😂",
      "🤣",
      "😊",
      "😇",
      "😉",
      "😌",
      "💋",
      "😍",
      "🥰",
      "😘",
      "😗",
      "😙",
      "👮‍♂️",
      "👑",
      "💎",
      "🎰",
      "💣",
      "❤️",
      "💔",
      "🔞",
      "📢",
      "🈶",
      "🈚️",
      "😚",
      "😋",
      "😛",
      "😝",
      "😜",
      "🤪",
      "🤨",
      "🧐",
      "🤓",
      "😎",
      "🤩",
      "🥳",
      "😏",
      "😒",
      "😞",
      "😕",
      "☹️",
      "😖",
      "😫",
      "😩",
      "🥺",
      "😢",
      "😭",
      "😤",
      "😠",
      "😡",
      "🤬",
      "🤯",
      "😳",
      "🥵",
      "🥶",
      "😱",
      "😨",
      "😰",
      "😥",
      "😓",
      "🤗",
      "🤔",
      "🤭",
      "🤫",
      "😬",
      "🙄",
      "😯",
      "😲",
      "😴",
      "🤤",
      "😪",
      "😵",
      "🤐",
      "🤮",
      "😷",
      "🤒",
      "🤑",
      "🤠",
      "😈",
      "👹",
      "👺",
      "🤡",
      "💩",
      "👻",
      "💀",
      "☠️",
      "👽",
      "🎃",
      "😺",
      "😸",
      "😹",
      "😻",
      "🙀",
      "😿",
      "😾",
    ];
    const store = useStore();
    const showEmoji = computed(() => {
      return store.state.chat.showEmoji;
    });
    function addEmoji(emoji: string) {
      console.log(emoji);
      //addEmoji
      emit("selectEmoji", emoji);
      //關閉emoji
      // store.commit("chat/setShowEmoji", false);
      //輸入框自動獲取焦點
      let input = document.getElementById("chatInputElement");
      input?.focus();
    }
    function emojiListUnfocusListener() {
      document.addEventListener("click", (e) => {
        if (showEmoji.value) {
          //當面板被打開時
          let emojiList = document.querySelector(".emojiList");
          let emojiBtn = document.querySelector(".bi-emoji-smile");
          let target = e.target;
          if (   //假如點擊的目標非表情列表本身 也不是 表情按鈕 也不是 表情列表裡面的子項目
            emojiList !== target &&
            target !== emojiBtn &&
            !emojiList?.contains(target as HTMLElement)
          ) {
            store.commit("chat/setShowEmoji", false);  //關閉表情列表
          }
        }
      });
    }
    return {
      //data
      emojiList,
      //methods
      addEmoji,
    };
  },
});
</script>
